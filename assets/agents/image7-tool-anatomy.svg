<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 740 445">
  <style>text{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}</style>
  <defs>
    <marker id="a" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0 0L10 5L0 10z" fill="#111"/>
    </marker>
    <marker id="err" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0 0L10 5L0 10z" fill="#c44"/>
    </marker>
    <marker id="ok" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0 0L10 5L0 10z" fill="#4a9"/>
    </marker>
    <marker id="res" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0 0L10 5L0 10z" fill="#999"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="370" y="20" text-anchor="middle" font-size="11" font-weight="600" fill="#999">TOOL LIFECYCLE &amp; ORIENTATIONS</text>

  <!-- AGENT container (white fill, solid thick border, ● icon — standard agent iconography) -->
  <rect x="108" y="34" width="530" height="86" rx="5" fill="#fff" stroke="#111" stroke-width="2"/>
  <circle cx="123" cy="48" r="3.5" fill="#111"/>
  <text x="133" y="52" font-size="10" font-weight="700" fill="#111">Agent</text>

  <!-- Working Memory (data style inside Agent — light gray fill, solid thin border) -->
  <rect x="130" y="60" width="486" height="52" rx="3" fill="#f7f7f7" stroke="#111" stroke-width="1"/>
  <text x="148" y="80" font-size="13" font-weight="700" fill="#111">Working Memory</text>
  <text x="148" y="96" font-size="9" fill="#666">Bootstrapped definitions in invariant prefix (cached across turns)</text>
  <!-- Tool schemas — definitions the agent reads, not tools themselves -->
  <rect x="516" y="68" width="95" height="22" rx="3" fill="#fff" stroke="#ddd" stroke-width="0.8"/>
  <text x="563" y="83" text-anchor="middle" font-size="8" fill="#999" font-style="italic">tool schemas</text>

  <!-- TOOL container (gray fill, dashed border — standard tool iconography) -->
  <rect x="210" y="134" width="316" height="140" rx="3" fill="#e8e8e8" stroke="#111" stroke-width="1.2" stroke-dasharray="3 2"/>
  <text x="224" y="148" font-size="9" font-weight="700" fill="#111">Tool</text>

  <!-- Arrow: invokes (drawn after Tool container so arrowhead is visible) -->
  <line x1="370" y1="112" x2="370" y2="134" stroke="#111" stroke-width="1.5" marker-end="url(#a)"/>
  <text x="380" y="128" font-size="8" fill="#666">invokes</text>

  <!-- Validation (data style: light gray fill, solid thin border) -->
  <rect x="222" y="152" width="296" height="44" rx="3" fill="#f7f7f7" stroke="#111" stroke-width="1"/>
  <text x="370" y="172" text-anchor="middle" font-size="12" font-weight="700" fill="#111">Validation</text>
  <text x="370" y="186" text-anchor="middle" font-size="9" fill="#666">Preconditions · Type checks · Permissions</text>

  <!-- Invalid arrow right to error -->
  <line x1="518" y1="174" x2="555" y2="174" stroke="#c44" stroke-width="1.5" marker-end="url(#err)"/>
  <text x="528" y="167" font-size="8" fill="#c44">✗</text>

  <!-- Introspective Error box -->
  <rect x="560" y="144" width="155" height="68" rx="3" fill="#fff" stroke="#c44" stroke-width="1.5"/>
  <text x="637" y="164" text-anchor="middle" font-size="10" font-weight="700" fill="#c44">Introspective Error</text>
  <line x1="572" y1="171" x2="703" y2="171" stroke="#f5d5d5" stroke-width="1"/>
  <text x="637" y="186" text-anchor="middle" font-size="8" fill="#666">"field 'X' not found.</text>
  <text x="637" y="197" text-anchor="middle" font-size="8" fill="#666">Available: [a, b, c, ...]"</text>
  <text x="637" y="208" text-anchor="middle" font-size="8" fill="#999" font-style="italic">Actionable, not opaque</text>

  <!-- Error feedback arrow: right edge → up → back into WM (return/secondary style) -->
  <path d="M715 178 Q728 178 728 164 L728 92 Q728 79 716 79 L616 79" fill="none" stroke="#c44" stroke-width="1.2" stroke-dasharray="5 3" marker-end="url(#err)"/>
  <text x="735" y="134" text-anchor="middle" font-size="7" fill="#c44" transform="rotate(-90 735 134)">feeds back</text>

  <!-- Valid arrow down -->
  <line x1="370" y1="196" x2="370" y2="224" stroke="#4a9" stroke-width="1.5" marker-end="url(#ok)"/>
  <text x="380" y="214" font-size="8" fill="#4a9">✓</text>

  <!-- Execution (tool style: gray fill, dashed border) -->
  <rect x="222" y="230" width="296" height="36" rx="3" fill="#e8e8e8" stroke="#111" stroke-width="1.2" stroke-dasharray="3 2"/>
  <text x="370" y="252" text-anchor="middle" font-size="12" font-weight="700" fill="#111">Execution</text>

  <!-- Branch arrows to two orientations -->
  <line x1="305" y1="266" x2="180" y2="306" stroke="#111" stroke-width="1.5" marker-end="url(#a)"/>
  <line x1="435" y1="266" x2="560" y2="306" stroke="#111" stroke-width="1.5" marker-end="url(#a)"/>

  <!-- STATE-FACING box (data style: light gray fill, solid thin border) -->
  <rect x="30" y="310" width="300" height="80" rx="3" fill="#f7f7f7" stroke="#111" stroke-width="1"/>
  <text x="180" y="332" text-anchor="middle" font-size="12" font-weight="700" fill="#111">State-facing</text>
  <text x="180" y="346" text-anchor="middle" font-size="9" fill="#666" font-style="italic">cognitive economy — self-reflection</text>
  <line x1="45" y1="353" x2="315" y2="353" stroke="#e5e5e5" stroke-width="1"/>
  <text x="70" y="370" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">list_tables</text>
  <text x="70" y="384" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">get_schema</text>
  <text x="200" y="370" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">read_context</text>
  <text x="200" y="384" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">search_state</text>

  <!-- WORLD-FACING box (world style: darker fill, thick border) -->
  <rect x="410" y="310" width="300" height="80" rx="4" fill="#e0e0e0" stroke="#111" stroke-width="2"/>
  <text x="560" y="332" text-anchor="middle" font-size="12" font-weight="700" fill="#111">World-facing</text>
  <text x="560" y="346" text-anchor="middle" font-size="9" fill="#666" font-style="italic">actions — external effects</text>
  <line x1="425" y1="353" x2="695" y2="353" stroke="#ccc" stroke-width="1"/>
  <text x="450" y="370" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">execute_sql</text>
  <text x="450" y="384" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">call_api</text>
  <text x="580" y="370" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">write_file</text>
  <text x="580" y="384" font-size="9" fill="#666" font-family="'SF Mono',Monaco,monospace">send_message</text>

  <!-- Labels beneath boxes -->
  <text x="180" y="409" text-anchor="middle" font-size="9" fill="#999">Reaches INTO state</text>
  <text x="560" y="409" text-anchor="middle" font-size="9" fill="#999">Reaches OUT to world</text>

  <!-- Result feedback arrow: left edge of Execution → up → back into WM (return/secondary style) -->
  <path d="M222 248 L85 248 Q70 248 70 234 L70 100 Q70 86 85 86 L130 86" fill="none" stroke="#999" stroke-width="1.2" stroke-dasharray="5 3" marker-end="url(#res)"/>
  <text x="63" y="172" text-anchor="middle" font-size="7" fill="#999" transform="rotate(-90 63 172)">result → working memory</text>

  <!-- Bottom annotation -->
  <text x="370" y="434" text-anchor="middle" font-size="9" fill="#999">All state mutations go through tools — results write to context window, introspectable, forceable (Section 3.3)</text>
</svg>
